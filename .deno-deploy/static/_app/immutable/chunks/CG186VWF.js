import{a as g,b as w,q as c,c as v,r as d,H as y,g as k,R as x,d as O,v as $,e as j,f as q}from"./67qOq2eY.js";import{A as E,v as p,Z as l,_ as b,j as _,i as s,$ as n}from"./CU_KDlvJ.js";async function P(a){const e=await fetch(a,{headers:{"x-sveltekit-pathname":location.pathname,"x-sveltekit-search":location.search}});if(!e.ok)throw new y(500,"Failed to execute remote function");const t=await e.json();if(t.type==="redirect")throw await k(t.location),new x(307,t.location);if(t.type==="error")throw new y(t.status??500,t.error);return O(t.result,w.decoders)}function A(a,e){return t=>{const o=g(t,w.hooks.transport),r=v(a,o);let i=c.get(r),h=!0;try{E(()=>(i&&i.count++,()=>{const f=c.get(r);f&&(f.count--,p().then(()=>{!f.count&&f===c.get(r)&&(c.delete(r),delete d[r])}))}))}catch{h=!1}let u=i?.resource;return u||(u=e(r,o),Object.defineProperty(u,"_key",{value:r}),c.set(r,i={count:h?1:0,resource:u}),u.then(()=>{p().then(()=>{!i.count&&i===c.get(r)&&c.delete(r)})}).catch(()=>{c.delete(r)})),u}}const m=`sveltekit:${$}`;let H;(async()=>{if(typeof caches<"u")try{H=await caches.open(m);const a=await caches.keys();for(const e of a)e.startsWith("sveltekit:")&&e!==m&&await caches.delete(e)}catch(a){console.warn("Failed to initialize SvelteKit cache:",a)}})();function z(a){return A(a,(e,t)=>new C(e,async()=>{if(Object.hasOwn(d,e))return d[e];const o=`${j}/${q}/remote/${a}${t?`?payload=${t}`:""}`;return await P(o)}))}class C{_key;#c=!1;#h;#e=l(!0);#t=[];#i=l(!1);#o=l();#n;#r=l(b([]));#u=_(()=>{if(s(this.#i))return s(this.#r).reduce((e,t)=>t(e),s(this.#o))});#a=l(void 0);#s=_(()=>{const e=s(this.#n);return s(this.#r).length,async(t,o)=>{try{await e,await p(),t?.(s(this.#u))}catch(r){o?.(r)}}});constructor(e,t){this._key=e,this.#h=t,this.#n=l(this.#l())}#l(){this.#c?n(this.#e,!0):this.#c=!0;let e,t;const o=new Promise((r,i)=>{e=r,t=i});return this.#t.push(e),Promise.resolve(this.#h()).then(r=>{const i=this.#t.indexOf(e);i!==-1&&(this.#t.splice(0,i).forEach(h=>h()),n(this.#i,!0),n(this.#e,!1),n(this.#o,r),n(this.#a,void 0),e())}).catch(r=>{const i=this.#t.indexOf(e);i!==-1&&(this.#t.splice(0,i).forEach(h=>h()),n(this.#a,r),n(this.#e,!1),t(r))}),o}get then(){return s(this.#s)}get catch(){return s(this.#s),e=>s(this.#s)(void 0,e)}get finally(){return s(this.#s),e=>s(this.#s)(()=>e(),()=>e())}get current(){return s(this.#u)}get error(){return s(this.#a)}get loading(){return s(this.#e)}get ready(){return s(this.#i)}refresh(){return delete d[this._key],n(this.#n,this.#l())}set(e){n(this.#i,!0),n(this.#e,!1),n(this.#a,void 0),n(this.#o,e),n(this.#n,Promise.resolve())}withOverride(e){return s(this.#r).push(e),{_key:this._key,release:()=>{const t=s(this.#r).indexOf(e);t!==-1&&s(this.#r).splice(t,1)}}}}export{z as q};
