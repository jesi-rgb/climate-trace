var T;function j(n){return{lang:n?.lang??T?.lang,message:n?.message,abortEarly:n?.abortEarly??T?.abortEarly,abortPipeEarly:n?.abortPipeEarly??T?.abortPipeEarly}}var B;function Q(n){return B?.get(n)}var V;function L(n){return V?.get(n)}var M;function J(n,s){return M?.get(n)?.get(s)}function C(n){const s=typeof n;return s==="string"?`"${n}"`:s==="number"||s==="bigint"||s==="boolean"?`${n}`:s==="object"||s==="function"?(n&&Object.getPrototypeOf(n)?.constructor?.name)??"null":s}function v(n,s,t,r,o){const c=o&&"input"in o?o.input:t.value,h=o?.expected??n.expects??null,f=o?.received??C(c),u={kind:n.kind,type:n.type,input:c,expected:h,received:f,message:`Invalid ${s}: ${h?`Expected ${h} but r`:"R"}eceived ${f}`,requirement:n.requirement,path:o?.path,issues:o?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},m=n.kind==="schema",d=o?.message??n.message??J(n.reference,u.lang)??(m?L(u.lang):null)??r.message??Q(u.lang);d!==void 0&&(u.message=typeof d=="function"?d(u):d),m&&(t.typed=!1),t.issues?t.issues.push(u):t.issues=[u]}function g(n){return{version:1,vendor:"valibot",validate(s){return n["~run"]({value:s},j())}}}function q(n,s){return Object.hasOwn(n,s)&&s!=="__proto__"&&s!=="prototype"&&s!=="constructor"}function K(n,s){const t=[...new Set(n)];return t.length>1?`(${t.join(` ${s} `)})`:t[0]??"never"}var z=class extends Error{constructor(n){super(n[0].message),this.name="ValiError",this.issues=n}};function A(n,s){return{kind:"validation",type:"min_value",reference:A,async:!1,expects:`>=${n instanceof Date?n.toJSON():C(n)}`,requirement:n,message:s,"~run"(t,r){return t.typed&&!(t.value>=this.requirement)&&v(this,"value",t,r,{received:t.value instanceof Date?t.value.toJSON():C(t.value)}),t}}}function H(n,s,t){return typeof n.fallback=="function"?n.fallback(s,t):n.fallback}function $(n,s,t){return typeof n.default=="function"?n.default(s,t):n.default}function p(n,s){return{kind:"schema",type:"array",reference:p,expects:"Array",async:!1,item:n,message:s,get"~standard"(){return g(this)},"~run"(t,r){const o=t.value;if(Array.isArray(o)){t.typed=!0,t.value=[];for(let c=0;c<o.length;c++){const h=o[c],f=this.item["~run"]({value:h},r);if(f.issues){const u={type:"array",origin:"value",input:o,key:c,value:h};for(const m of f.issues)m.path?m.path.unshift(u):m.path=[u],t.issues?.push(m);if(t.issues||(t.issues=f.issues),r.abortEarly){t.typed=!1;break}}f.typed||(t.typed=!1),t.value.push(f.value)}}else v(this,"type",t,r);return t}}}function k(n){return{kind:"schema",type:"boolean",reference:k,expects:"boolean",async:!1,message:n,get"~standard"(){return g(this)},"~run"(s,t){return typeof s.value=="boolean"?s.typed=!0:v(this,"type",s,t),s}}}function S(n,s){return{kind:"schema",type:"nullable",reference:S,expects:`(${n.expects} | null)`,async:!1,wrapped:n,default:s,get"~standard"(){return g(this)},"~run"(t,r){return t.value===null&&(this.default!==void 0&&(t.value=$(this,t,r)),t.value===null)?(t.typed=!0,t):this.wrapped["~run"](t,r)}}}function a(n){return{kind:"schema",type:"number",reference:a,expects:"number",async:!1,message:n,get"~standard"(){return g(this)},"~run"(s,t){return typeof s.value=="number"&&!isNaN(s.value)?s.typed=!0:v(this,"type",s,t),s}}}function l(n,s){return{kind:"schema",type:"object",reference:l,expects:"Object",async:!1,entries:n,message:s,get"~standard"(){return g(this)},"~run"(t,r){const o=t.value;if(o&&typeof o=="object"){t.typed=!0,t.value={};for(const c in this.entries){const h=this.entries[c];if(c in o||(h.type==="exact_optional"||h.type==="optional"||h.type==="nullish")&&h.default!==void 0){const f=c in o?o[c]:$(h),u=h["~run"]({value:f},r);if(u.issues){const m={type:"object",origin:"value",input:o,key:c,value:f};for(const d of u.issues)d.path?d.path.unshift(m):d.path=[m],t.issues?.push(d);if(t.issues||(t.issues=u.issues),r.abortEarly){t.typed=!1;break}}u.typed||(t.typed=!1),t.value[c]=u.value}else if(h.fallback!==void 0)t.value[c]=H(h);else if(h.type!=="exact_optional"&&h.type!=="optional"&&h.type!=="nullish"&&(v(this,"key",t,r,{input:void 0,expected:`"${c}"`,path:[{type:"object",origin:"key",input:o,key:c,value:o[c]}]}),r.abortEarly))break}}else v(this,"type",t,r);return t}}}function i(n,s){return{kind:"schema",type:"optional",reference:i,expects:`(${n.expects} | undefined)`,async:!1,wrapped:n,default:s,get"~standard"(){return g(this)},"~run"(t,r){return t.value===void 0&&(this.default!==void 0&&(t.value=$(this,t,r)),t.value===void 0)?(t.typed=!0,t):this.wrapped["~run"](t,r)}}}function x(n,s){return{kind:"schema",type:"picklist",reference:x,expects:K(n.map(C),"|"),async:!1,options:n,message:s,get"~standard"(){return g(this)},"~run"(t,r){return this.options.includes(t.value)?t.typed=!0:v(this,"type",t,r),t}}}function R(n,s,t){return{kind:"schema",type:"record",reference:R,expects:"Object",async:!1,key:n,value:s,message:t,get"~standard"(){return g(this)},"~run"(r,o){const c=r.value;if(c&&typeof c=="object"){r.typed=!0,r.value={};for(const h in c)if(q(c,h)){const f=c[h],u=this.key["~run"]({value:h},o);if(u.issues){const d={type:"object",origin:"key",input:c,key:h,value:f};for(const y of u.issues)y.path=[d],r.issues?.push(y);if(r.issues||(r.issues=u.issues),o.abortEarly){r.typed=!1;break}}const m=this.value["~run"]({value:f},o);if(m.issues){const d={type:"object",origin:"value",input:c,key:h,value:f};for(const y of m.issues)y.path?y.path.unshift(d):y.path=[d],r.issues?.push(y);if(r.issues||(r.issues=m.issues),o.abortEarly){r.typed=!1;break}}(!u.typed||!m.typed)&&(r.typed=!1),u.typed&&(r.value[u.value]=m.value)}}else v(this,"type",r,o);return r}}}function e(n){return{kind:"schema",type:"string",reference:e,expects:"string",async:!1,message:n,get"~standard"(){return g(this)},"~run"(s,t){return typeof s.value=="string"?s.typed=!0:v(this,"type",s,t),s}}}function P(){return{kind:"schema",type:"unknown",reference:P,expects:"unknown",async:!1,get"~standard"(){return g(this)},"~run"(n){return n.typed=!0,n}}}function I(n,s,t){const r=n["~run"]({value:s},j(t));if(r.issues)throw new z(r.issues);return r.value}function N(...n){return{...n[0],pipe:n,get"~standard"(){return g(this)},"~run"(s,t){for(const r of n)if(r.kind!=="metadata"){if(s.issues&&(r.kind==="schema"||r.kind==="transformation")){s.typed=!1;break}(!s.issues||!t.abortEarly&&!t.abortPipeEarly)&&(s=r["~run"](s,t))}return s}}}const W=l({id:a(),name:e(),sector:e(),subsector:e(),country:e(),emissionsQuantity:a(),gas:e(),year:a(),assetType:e(),sourceType:e()}),Y=i(l({year:i(N(a(),A(2021))),gas:i(e()),sectors:i(p(e())),subsectors:i(p(e())),gadmId:i(e()),cityId:i(e()),countryGroup:i(e()),continent:i(e()),ownerIds:i(p(e())),limit:i(a()),offset:i(a())})),X=S(p(W)),Z=l({latitude:a(),longitude:a(),srid:a()}),ee=l({id:e(),name:e()}),se=l({year:a(),month:i(a()),emissionsQuantity:a(),gas:e(),sector:i(e()),subsector:i(e()),activity:i(a()),activityUnits:i(e()),capacity:i(a()),capacityFactor:i(a()),capacityUnits:i(e()),emissionsFactor:i(a()),emissionsFactorUnits:i(e())}),te=l({year:a(),activity:i(e()),asset_type:i(e()),capacity:i(e()),capacity_factor:i(e()),ch4_emissions:i(e()),ch4_emissions_factor:i(e()),co2_emissions:i(e()),co2_emissions_factor:i(e()),n2o_emissions:i(e()),n2o_emissions_factor:i(e()),other_gas_emissions:i(e()),other_gas_emissions_factor:i(e()),total_co2e_20yrgwp:i(e()),total_co2e_100yrgwp:i(e())}),ne=l({rank:a(),year:a()}),ie=l({gas:e(),emissionsQuantity:a(),emissionsFactor:i(a()),emissionsFactorUnits:i(e()),activity:i(a()),activityUnits:i(e()),capacity:i(a()),capacityUnits:i(e()),capacityFactor:i(a())}),re=l({id:a(),name:e(),sector:e(),subsector:e(),country:e(),assetType:e(),sourceType:e(),centroid:Z,emissions:S(p(se)),owners:S(p(ee)),confidence:S(p(te)),totals:ie,subsectorRanks:S(p(ne))}),oe=l({id:a(),start:i(e()),end:i(e()),timeGranularity:i(x(["month","year"])),gas:i(e())}),U=l({name:e(),country:i(e()),gadmId:i(e()),cityId:i(e()),continent:i(e()),countryGroup:i(e())}),ae=l({emissionsQuantity:a(),gas:e(),percentage:a(),sector:i(e()),subsector:i(e())}),F=l({emissionsQuantity:a(),gas:e(),month:i(a()),sector:i(e()),subsector:i(e()),year:a()}),w=l({summaries:p(ae),timeseries:p(F)}),ce=l({id:e(),name:e()}),ue=l({location:U,owners:i(p(ce)),sectors:w,subsectors:w,totals:w}),he=i(l({year:i(N(a(),A(2021))),gas:i(e()),sectors:i(p(e())),subsectors:i(p(e())),gadmId:i(e()),cityId:i(e()),countryGroup:i(e()),continent:i(e()),ownerIds:i(p(e()))})),le=l({country:e(),name:e(),rank:a(),emissionsQuantity:a(),emissionsPerCapita:a(),gas:e(),percentage:a()}),pe=l({emissionsQuantity:a(),gas:e(),start:e(),end:e(),timeseries:i(p(F))}),me=l({location:U,rankings:p(le),totals:pe}),ye=i(l({gas:i(e()),start:i(e()),end:i(e()),sectors:i(p(e())),subsectors:i(p(e())),countryGroup:i(e()),continent:i(e())})),Se=p(e()),be=l({id:e(),name:e(),full_name:e(),level:a(),level_0_id:e(),level_1_id:e(),level_2_id:e()}),Ee=l({id:e(),name:e(),matchedName:e(),country:e(),alternateNames:p(e())}),_e=l({id:e(),name:e(),continent:e()}),ke=l({name:e(),sector:e(),sectorDisplay:e(),subsectorDisplay:e(),asset:k(),country:k(),locationDisplay:k(),dataLeads:p(R(e(),P()))}),Ce=l({id:e(),name:e()}),fe={getSources:{path:"/v7/sources",method:"GET",paramsSchema:Y,responseSchema:X,_types:{}},getSourceById:{path:"/v7/sources/:id",method:"GET",paramsSchema:oe,responseSchema:re,_types:{}},getAggregatedEmissions:{path:"/v7/sources/emissions",method:"GET",paramsSchema:he,responseSchema:ue,_types:{}},getCountryRankings:{path:"/v7/rankings/countries",method:"GET",paramsSchema:ye,responseSchema:me,_types:{}},searchAdmins:{path:"/v7/admins",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getAdminById:{path:"/v7/admins/:id",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getAdminSubdivisions:{path:"/v7/admins/:id/subdivisions",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},searchCities:{path:"/v7/cities",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},searchOwners:{path:"/v7/owners",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getContinents:{path:"/v7/definitions/continents",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getContinentDetails:{path:"/v7/definitions/continents/:continent",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getCountries:{path:"/v7/definitions/countries",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getCountryDetails:{path:"/v7/definitions/countries/:country",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getCountryGroups:{path:"/v7/definitions/countrygroups",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getCountryGroupDetails:{path:"/v7/definitions/countrygroups/:group",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getGases:{path:"/v7/definitions/gases",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getSectors:{path:"/v7/definitions/sectors",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getSectorDetails:{path:"/v7/definitions/sectors/:sector",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getSubsectors:{path:"/v7/definitions/subsectors",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}},getSubsectorDetails:{path:"/v7/definitions/subsectors/:subsector",method:"GET",paramsSchema:void 0,responseSchema:void 0,_types:{}}},D={definitions:1440*60*1e3,reference:720*60*1e3,dynamic:3600*1e3,none:0},G={getContinents:"definitions",getContinentDetails:"definitions",getCountries:"definitions",getCountryDetails:"definitions",getCountryGroups:"definitions",getCountryGroupDetails:"definitions",getGases:"definitions",getSectors:"definitions",getSectorDetails:"definitions",getSubsectors:"definitions",getSubsectorDetails:"definitions",searchCities:"reference",searchAdmins:"reference",getAdminById:"reference",getAdminSubdivisions:"reference",searchOwners:"reference",getCountryRankings:"dynamic",getAggregatedEmissions:"dynamic",getSources:"none",getSourceById:"none"};class de{cache=new Map;hits=0;misses=0;getCacheKey(s,t){return t?`${s}:${JSON.stringify(t,Object.keys(t).sort())}`:s}shouldCache(s){return s.startsWith("get")&&s.includes("Country")?!0:G[s]!=="none"}getTTL(s){if(s.startsWith("get")&&s.includes("Country"))return D.definitions;const t=G[s];return D[t]}isValid(s){return Date.now()-s.timestamp<s.ttl}get(s,t){if(!this.shouldCache(s))return null;const r=this.getCacheKey(s,t),o=this.cache.get(r);return o?this.isValid(o)?(this.hits++,o.data):(this.cache.delete(r),this.misses++,null):(this.misses++,null)}set(s,t,r){if(!this.shouldCache(s))return;const o=this.getCacheKey(s,t),c=this.getTTL(s);this.cache.set(o,{data:r,timestamp:Date.now(),ttl:c})}invalidate(s,t){const r=this.getCacheKey(s,t);this.cache.delete(r)}clear(s){if(!s){this.cache.clear(),this.hits=0,this.misses=0;return}const t=Object.entries(G).filter(([r,o])=>o===s).map(([r])=>r);for(const[r]of this.cache){const o=r.split(":")[0];t.includes(o)&&this.cache.delete(r)}}getStats(){const s=this.hits+this.misses,t=s>0?this.hits/s:0,r=Array.from(this.cache.entries()).map(([o,c])=>({key:o,age:Date.now()-c.timestamp,ttl:c.ttl}));return{size:this.cache.size,hits:this.hits,misses:this.misses,hitRate:Math.round(t*100)/100,entries:r}}}const O=new de,ge="https://api.climatetrace.org";class ve extends Error{constructor(s,t,r){super(s),this.status=t,this.statusText=r,this.name="ApiError"}}async function E(n,s){const t=O.get(n,s);if(t!==null)return t;const r=fe[n];if(r.paramsSchema&&s!==void 0)try{I(r.paramsSchema,s)}catch(y){throw new Error(`Invalid parameters for ${n}: ${y}`)}let o=`${ge}${r.path}`;const c=new URLSearchParams;s&&Object.entries(s).forEach(([_,b])=>{b!==void 0&&(o.includes(`:${_}`)?o=o.replace(`:${_}`,String(b)):Array.isArray(b)?c.set(_,b.join(",")):c.set(_,String(b)))});const h=c.toString(),f=h?`${o}?${h}`:o;let u;try{u=await fetch(f)}catch(y){throw new Error(`Network error calling ${n}: ${y}`)}if(!u.ok){const y=await u.text().catch(()=>"Unknown error");throw new ve(`API request failed: ${u.status} ${u.statusText} - ${y}`,u.status,u.statusText)}let m;try{m=await u.json()}catch(y){throw new Error(`Failed to parse JSON response from ${n}: ${y}`)}if(r.responseSchema)try{m=I(r.responseSchema,m)}catch(y){throw console.error(`Response validation failed for ${n}:`,y),new Error(`Invalid response from ${n}: ${y}`)}const d=m;return O.set(n,s,d),d}async function Te(n){return E("getSources",n)}async function we(n,s){return E("getSourceById",{...s,id:n})}async function Ge(n){return E("getAggregatedEmissions",n)}async function Ae(n){return E("getCountryRankings",n)}const $e=E;export{be as AdministrativeAreaSchema,w as AggregateEmissionsOverviewSchema,ae as AggregateEmissionsSummarySchema,F as AggregateEmissionsTimePeriodSchema,he as AggregatedEmissionsParamsSchema,ue as AggregatedEmissionsResponseSchema,ve as ApiError,ne as AssetSubsectorRankSchema,Ee as CitiesSearchResultSchema,te as ConfidenceTimePeriodSchema,le as CountryEmissionsRankSchema,me as CountryEmissionsRankingsResponseSchema,pe as CountryEmissionsTotalsSchema,ye as CountryRankingsParamsSchema,_e as CountrySchema,U as EmissionsLocationSchema,ce as OwnerSchema,Ce as OwnersSearchResultSchema,oe as SourceByIdParamsSchema,Z as SourceCentroidSchema,re as SourceDetailsSchema,se as SourceEmissionsTimePeriodSchema,ee as SourceOwnerSchema,W as SourceSummarySchema,ie as SourceTotalsSchema,Y as SourcesParamsSchema,X as SourcesResponseSchema,Se as StringArraySchema,ke as SubSectorSchema,O as apiCache,$e as apiCall,E as ct,Ge as getAggregatedEmissions,Ae as getCountryRankings,we as getSourceById,Te as getTopSources};
